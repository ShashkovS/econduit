(function(){function a(){$.fn.floatHeader=function(){return this.each(function(){var j=$(this);j.floatBox=j.siblings(".floatHeader");var k=j.floatBox.children("table");$(window).scroll(function(){if(f(j,j.floatBox)){if(!j.floatBox.is(":visible")){c(k,j)}j.floatBox.show().css({top:0,left:j.offset().left-$(window).scrollLeft()})}else{j.floatBox.hide()}});$(window).resize(function(){if(j.floatBox.is(":visible")){c(k,j)}})})};function c(l,k){var j=k.width();if(navigator.userAgent.indexOf("Firefox")>-1&&j<window.innerWidth){l.css("width","")}else{l.width(j)}var m=l.find("thead th:first-child");k.find("th").each(function(n,o){m=m.width($(o).width()).next()})}function f(m,l){if(!m.is(":visible")){return false}var o=$(window).scrollTop();var n=m.offset().top;var j=m.height()-l.height();var k=m.children("tfoot");if(k.length>0){j-=k.height()}return n<=o&&o<=n+j}function h(){$(this).siblings(".pupilName").andSelf().addClass("mouseOver");$(this).closest(".conduit_container").find(".headerRow").children(":nth-child("+(this.cellIndex+1)+")").addClass("mouseOver")}function g(){$(this).parent().addClass("mouseOver")}function d(){$(this).closest(".conduit_container").find("tr").children(":nth-child("+(this.cellIndex+1)+")").addClass("mouseOver")}function e(){$(this).closest(".conduit_container").find("*").removeClass("mouseOver")}function b(){var k=Globals.ClassID,m=$(this).closest(".conduit_container"),j=m.attr("data-id");if(m.attr("data-state")==="opened"){m.attr("data-state","closed");i(k,j,false)}else{if(m.attr("data-state")==="empty"){var l=m.children(".loading");l.show();$.ajax({type:"POST",url:"ajax/GetConduit.php",data:{Class:k,List:j},dataType:"html",success:function(n){l.hide();m.append(n);m.children(".conduit").floatHeader()},error:function(n,p,o){alert("Не удалось получить ответ от сервера: "+n.status+" "+p)}})}m.attr("data-state","opened");i(k,j,true)}}function i(l,j,m){var k="ec_open",n=($.cookie(k)||"").split(","),o=$.inArray(j,n);if(m&&(o==-1)){n.push(j)}else{if(!m&&(o!=-1)){n.splice(o,1)}}$.cookie(k,n.join(","),{expires:30})}this.init=function(){var j=$("#conduits");j.on({mouseover:d,mouseout:e},".conduit .problemName");j.on({mouseover:g,mouseout:e},".conduit .pupilName");j.on({mouseover:h,mouseout:e},".conduit td");j.on({click:b},".conduit_spoiler");$(".conduit_container>.conduit").floatHeader()}}window.Conduit=new a()})();