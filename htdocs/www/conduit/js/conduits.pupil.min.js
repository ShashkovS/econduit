(function(){$.fn.floatHeader=function(){return this.each(function(){var c=$(this);c.floatBox=c.siblings(".floatHeader");var d=c.floatBox.children("table");$(window).scroll(function(){if(b(c,c.floatBox)){if(!c.floatBox.is(":visible")){a(d,c)}c.floatBox.show().css({top:0,left:c.offset().left-$(window).scrollLeft()})}else{c.floatBox.hide()}});$(window).resize(function(){if(c.floatBox.is(":visible")){a(d,c)}})})};function a(e,d){var c=d.width();if(navigator.userAgent.indexOf("Firefox")>-1&&c<window.innerWidth){e.css("width","")}else{e.width(c)}var f=e.find("thead th:first-child");d.find("th").each(function(g,h){f=f.width($(h).width()).next()})}function b(f,e){if(!f.is(":visible")){return false}var h=$(window).scrollTop();var g=f.offset().top;var c=f.height()-e.height();var d=f.children("tfoot");if(d.length>0){c-=d.height()}return g<=h&&h<=g+c}})();(function(){function a(){function f(){$(this).siblings(".pupilName").andSelf().addClass("mouseOver");$(this).closest(".conduit_container").find(".headerRow").children(":nth-child("+(this.cellIndex+1)+")").addClass("mouseOver")}function e(){$(this).parent().addClass("mouseOver")}function c(){$(this).closest(".conduit_container").find("tr").children(":nth-child("+(this.cellIndex+1)+")").addClass("mouseOver")}function d(){$(this).closest(".conduit_container").find("*").removeClass("mouseOver")}function b(){var i=Globals.ClassID,h=$(this).attr("data-id");if($(this).attr("data-state")==="opened"){$(this).attr("data-state","closed");g(i,h,false)}else{if($(this).attr("data-state")==="empty"){var k=$(this).siblings(".conduit_container"),j=$(this).siblings(".loading");j.show();$.ajax({type:"POST",url:"ajax/GetConduit.php",data:{Class:i,List:h},dataType:"html",success:function(l){j.hide();k.html(l);k.children(".conduit").floatHeader()},error:function(l,n,m){alert("Не удалось получить ответ от сервера: "+l.status+" "+n)}})}$(this).attr("data-state","opened");g(i,h,true)}}function g(j,h,k){var i="ec_open",l=($.cookie(i)||"").split(","),m=$.inArray(h,l);if(k&&(m==-1)){l.push(h)}else{if(!k&&(m!=-1)){l.splice(m,1)}}$.cookie(i,l.join(","),{expires:30})}this.init=function(){var h=$("#conduits");h.on({mouseover:c,mouseout:d},".conduit .problemName");h.on({mouseover:e,mouseout:d},".conduit .pupilName");h.on({mouseover:f,mouseout:d},".conduit td");h.on({click:b},".conduit_spoiler")}}window.Conduit=new a()})();